{% extends 'base.html' %}
{% block content %}
<h1>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±ÛŒØ§Ù†</h1>
<form class="filters" method="get">
    <label>Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
        <select name="category">
            <option value="all" {{ 'selected' if category == 'all' else '' }}>Ù‡Ù…Ù‡</option>
            {% for key, label in service_message_labels.items() %}
            <option value="{{ key }}" {{ 'selected' if category == key else '' }}>{{ label }}</option>
            {% endfor %}
        </select>
    </label>
    <button type="submit" class="btn-primary">Ø§Ø¹Ù…Ø§Ù„</button>
</form>
<section class="panel">
    <header>
        <h2>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ ({{ total }})</h2>
    </header>
    <table>
        <thead>
            <tr>
                <th>ØªØ§Ø±ÛŒØ®</th>
                <th>Ú©Ø§Ø±Ø¨Ø±</th>
                <th>Ø¯Ø³ØªÙ‡</th>
                <th>Ù…ØªÙ†</th>
                <th>Ù¾ÛŒÙˆØ³Øª</th>
                <th>ÙˆØ¶Ø¹ÛŒØª</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
        </thead>
        <tbody>
            {% for msg in messages_list %}
            <tr>
                <td>{{ format_datetime(msg.created_at) }}</td>
                <td>
                    <div>{{ msg.first_name or 'â€”' }}</div>
                    <small>@{{ msg.username or 'â€”' }} â€” {{ msg.user_id or 'Ø¨Ø¯ÙˆÙ† Ø¢ÛŒØ¯ÛŒ' }}</small>
                </td>
                <td>{{ service_message_labels.get(msg.category, msg.category) }}</td>
                <td class="message-text">{{ (msg.message_text or 'â€”')|replace('\n','<br>')|safe }}</td>
                <td>
                    {% if msg.attachment_file_id %}
                    <a class="link" href="{{ url_for('message_attachment', message_id=msg.id) }}" target="_blank">Ø¯Ø§Ù†Ù„ÙˆØ¯</a>
                    {% else %}
                    â€”
                    {% endif %}
                </td>
                <td>
                    {% if msg.is_resolved %}
                        <span class="badge completed">Ø¨Ø³ØªÙ‡</span>
                    {% else %}
                        <span class="badge in_progress">Ø¨Ø§Ø²</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <a class="link" href="{{ url_for('message_detail', message_id=msg.id) }}">Ù…Ø¯ÛŒØ±ÛŒØª</a>
                        <form method="post" action="{{ url_for('message_delete', message_id=msg.id) }}" 
                              onsubmit="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ÛŒØ§Øª ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø³Øª.');" 
                              style="margin:0;">
                            <button type="submit" class="btn-ghost danger" style="font-size: 0.85rem; padding: 0.2rem 0.5rem;">
                                Ø­Ø°Ù ğŸ—‘ï¸
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="7" class="empty">Ù¾ÛŒØ§Ù…ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    {% if pages > 1 %}
    <div class="pagination">
        {% for p in range(1, pages + 1) %}
            <a href="?category={{ category }}&page={{ p }}" class="{{ 'active' if p == page else '' }}">{{ p }}</a>
        {% endfor %}
    </div>
    {% endif %}
</section>
{% endblock %}
